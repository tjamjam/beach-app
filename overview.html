<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beach Overview - All Burlington Beaches</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-image: url('images/background.jpg');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
        }
        
        .header {
            color: white;
            padding: 40px 20px 20px 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2em;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .layout-wrapper {
            display: flex;
            gap: 30px;
            align-items: stretch;
        }
        
        .table-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }
        
        .map-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }
        
        .map-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .map-header h2 {
            margin: 0;
            color: #333;
        }
        
        #map {
            height: 100%;
            width: 100%;
            min-height: 400px;
        }
        
        .table-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .table-header h2 {
            margin: 0;
            color: #333;
        }
        
        .beach-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .beach-table th,
        .beach-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .beach-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
        }
        
        .beach-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            text-transform: uppercase;
        }
        
        .status-green {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-yellow {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-red {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-unknown {
            background-color: #e2e3e5;
            color: #383d41;
        }
        
        .beach-name {
            font-weight: bold;
            color: #333;
        }
        
        .coordinates {
            font-family: monospace;
            font-size: 0.9em;
            color: #666;
        }
        
        .note {
            max-width: 300px;
            word-wrap: break-word;
        }
        
        .last-updated {
            font-size: 0.9em;
            color: #666;
        }
        
        .timeline-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 30px;
            overflow: hidden;
        }
        
        .timeline-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .timeline-header h2 {
            margin: 0;
            color: #333;
        }
        
        .timeline-heatmap {
            padding: 20px;
            overflow-x: auto;
        }
        
        #d3-heatmap {
            width: 100%;
            min-height: 500px;
            background: white;
            border-radius: 8px;
            padding: 20px;
        }
        
        .heatmap-table {
            border-collapse: collapse;
            width: 100%;
            min-width: 800px;
        }
        
        .heatmap-table th {
            background-color: #f8f9fa;
            padding: 10px;
            text-align: center;
            font-size: 0.8em;
            border: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .heatmap-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #eee;
            font-size: 0.8em;
        }
        
        .heatmap-cell {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            display: inline-block;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.2);
        }
        
        .heatmap-cell.green {
            background-color: #00a045;
        }
        
        .heatmap-cell.yellow {
            background-color: #c7a900;
        }
        
        .heatmap-cell.red {
            background-color: #c21616;
        }
        
        .heatmap-cell.unknown {
            background-color: #666;
        }
        
        .beach-name-cell {
            text-align: left;
            font-weight: bold;
            color: #333;
            min-width: 150px;
        }
        
        .percentage-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .percentage-badge.excellent {
            background-color: #00a045;
            color: white;
        }
        
        .percentage-badge.good {
            background-color: #c7a900;
            color: white;
        }
        
        .percentage-badge.fair {
            background-color: #ff8c00;
            color: white;
        }
        
        .percentage-badge.poor {
            background-color: #c21616;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #721c24;
            background-color: #f8d7da;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .nav-link {
            display: inline-block;
            margin-top: 10px;
            color: #007bff;
            text-decoration: none;
        }
        
        .nav-link:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .layout-wrapper {
                flex-direction: column;
                gap: 20px;
            }
            
            #map {
                height: 300px;
            }
            
            .beach-table {
                font-size: 0.9em;
            }
            
            .beach-table th,
            .beach-table td {
                padding: 10px 5px;
            }
            
            .note {
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Beach Overview</h1>
        <p>All Burlington beaches and their current water quality status</p>
        <p style="margin-top: 20px;">
            <a href="index.html" style="color: white; text-decoration: none; font-size: 0.9em;">
                ‚Üê Back to Lakewood Beach Status
            </a>
        </p>
    </div>
    
    <div class="container">
        <div class="layout-wrapper">
            <div class="table-section">
                <div class="table-header">
                    <h2>All Beaches Status</h2>
                    <p>Complete water quality information from official sources</p>
                </div>
                <div id="table-content">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Loading beach data...
                    </div>
                </div>
            </div>
            
            <div class="map-section">
                <div class="map-header">
                    <h2>Interactive Map</h2>
                    <p>Click on pins to see beach details</p>
                </div>
                <div id="map"></div>
            </div>
        </div>
        
        <div class="timeline-section">
            <div class="timeline-header">
                <h2>Historical Timeline</h2>
                <p>Beach status changes over time</p>
            </div>
            <div id="timeline-content">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> Loading historical data...
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const STATUS_JSON_URL = window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost'
            ? '../status.json'
            : 'https://raw.githubusercontent.com/tjamjam/beach-app/main/status.json';

        // Initialize map
        const map = L.map('map').setView([44.5, -73.24], 12);
        
        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Custom icons for different statuses - matching index page colors
        const statusIcons = {
            green: L.divIcon({
                html: '<div style="background-color: #00a045; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);"></div>',
                className: 'custom-div-icon',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            }),
            yellow: L.divIcon({
                html: '<div style="background-color: #c7a900; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);"></div>',
                className: 'custom-div-icon',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            }),
            red: L.divIcon({
                html: '<div style="background-color: #c21616; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);"></div>',
                className: 'custom-div-icon',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            }),
            unknown: L.divIcon({
                html: '<div style="background-color: #666; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);"></div>',
                className: 'custom-div-icon',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            })
        };

        let beaches = [];
        let markers = [];
        let fakeHistoricalData = [];

        async function fetchBeachData() {
            try {
                const response = await fetch(`${STATUS_JSON_URL}?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error('Failed to fetch beach data');
                
                beaches = await response.json();
                updateMap();
                updateTable();
                
            } catch (error) {
                console.error('Error fetching beach data:', error);
                document.getElementById('table-content').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        Failed to load beach data. Please try again later.
                    </div>
                `;
            }
        }

        function updateMap() {
            // Clear existing markers
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];

            // Add markers for each beach
            beaches.forEach(beach => {
                if (beach.coordinates) {
                    const icon = statusIcons[beach.status] || statusIcons.unknown;
                    const marker = L.marker([beach.coordinates.lat, beach.coordinates.lon], { icon })
                        .addTo(map)
                        .bindPopup(`
                            <div style="text-align: center;">
                                <h3 style="margin: 0 0 10px 0;">${beach.beach_name}</h3>
                                <div class="status-badge status-${beach.status}">${beach.status.toUpperCase()}</div>
                                ${beach.note ? `<p style="margin: 10px 0 0 0; font-size: 0.9em;">${beach.note}</p>` : ''}
                                <p style="margin: 10px 0 0 0; font-size: 0.8em; color: #666;">Last updated: ${beach.date}</p>
                            </div>
                        `);
                    markers.push(marker);
                }
            });

            // Fit map to show all markers
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        function updateTable() {
            const tableContent = document.getElementById('table-content');
            
            if (!beaches || beaches.length === 0) {
                tableContent.innerHTML = '<div class="error">No beach data available</div>';
                return;
            }

            // Calculate summer open percentages for each beach
            const summerOpenPercentages = calculateSummerOpenPercentages();

            const tableHTML = `
                <table class="beach-table">
                    <thead>
                        <tr>
                            <th>Beach Name</th>
                            <th>Status</th>
                            <th>Last Updated</th>
                            <th>Note</th>
                            <th>Aug 2025 Open Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${beaches.map(beach => {
                            const openPercentage = summerOpenPercentages[beach.beach_name] || 0;
                            return `
                                <tr>
                                    <td class="beach-name">${beach.beach_name}</td>
                                    <td>
                                        <span class="status-badge status-${beach.status}">
                                            ${beach.status.toUpperCase()}
                                        </span>
                                    </td>
                                    <td class="last-updated">${beach.date}</td>
                                    <td class="note">${beach.note || 'No additional information'}</td>
                                    <td>
                                        <span class="percentage-badge ${getPercentageClass(openPercentage)}">
                                            ${openPercentage}%
                                        </span>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            
            tableContent.innerHTML = tableHTML;
        }

        function calculateSummerOpenPercentages() {
            // Define summer season dates for 2025 (Aug 1 to current date)
            const startDate2025 = new Date('2025-08-01'); // Start collecting data Aug 1, 2025
            const currentDate = new Date(); // Today's date
            
            const percentages = {};
            
            // Get unique beach names from the current beach data
            const beachNames = beaches.map(beach => beach.beach_name);
            
            beachNames.forEach(beachName => {
                let totalDays = 0;
                let openDays = 0;
                
                // Count days from Aug 1 to today
                const checkDate = new Date(startDate2025);
                while (checkDate <= currentDate) {
                    totalDays++;
                    
                    // Check if this date exists in our real historical data
                    const dateString = checkDate.toLocaleDateString();
                    const historicalEntry = fakeHistoricalData.find(entry => {
                        const entryDate = new Date(entry.record_timestamp_utc);
                        return entry.beach_name === beachName && 
                               entryDate.getFullYear() === checkDate.getFullYear() &&
                               entryDate.getMonth() === checkDate.getMonth() &&
                               entryDate.getDate() === checkDate.getDate();
                    });
                    
                    if (historicalEntry && historicalEntry.status === 'green') {
                        openDays++;
                    } else if (!historicalEntry) {
                        // If no historical data for this date, assume it's open (current status)
                        openDays++;
                    }
                    
                    checkDate.setDate(checkDate.getDate() + 1);
                }
                
                const percentage = totalDays > 0 ? Math.round((openDays / totalDays) * 100) : 0;
                percentages[beachName] = percentage;
            });
            
            return percentages;
        }

        function getPercentageClass(percentage) {
            if (percentage >= 80) return 'excellent';
            if (percentage >= 60) return 'good';
            if (percentage >= 40) return 'fair';
            return 'poor';
        }

        async function fetchHistoricalData() {
            try {
                console.log('üîç Starting to fetch historical data...');
                
                // Use the real historical dataset - try local first, then GitHub as fallback
                let response;
                try {
                    // Try real historical data first (now has rich multi-day data)
                    console.log('üìÅ Trying real historical data...');
                    response = await fetch('../backend/historical_status.csv');
                    if (!response.ok) throw new Error('Real data not found, trying fake data');
                    console.log('‚úÖ Real historical data loaded successfully');
                } catch (localError) {
                    // Fallback to fake historical data
                    console.log('‚ùå Real data not found, trying fake historical data...', localError);
                    try {
                        response = await fetch('../backend/fake_historical_status.csv');
                        if (!response.ok) throw new Error('Fake data not found');
                        console.log('‚úÖ Fake historical data loaded');
                    } catch (fakeError) {
                        // Final fallback to GitHub
                        console.log('‚ùå Local files not found, trying GitHub...', fakeError);
                        response = await fetch('https://raw.githubusercontent.com/tjamjam/beach-app/main/backend/historical_status.csv');
                        console.log('üåê GitHub response status:', response.status);
                    }
                }
                if (!response.ok) throw new Error(`Failed to fetch historical data - Status: ${response.status}`);
                
                const csvText = await response.text();
                console.log('üìÑ CSV text received, length:', csvText.length);
                console.log('üìù First 200 chars:', csvText.substring(0, 200));
                
                const historicalData = parseCSV(csvText);
                console.log('üìä Parsed historical data:', historicalData.length, 'records');
                console.log('üîç Sample record:', historicalData[0]);
                
                fakeHistoricalData = historicalData; // Store globally for percentage calculations
                updateTimeline(historicalData);
                
            } catch (error) {
                console.error('‚ùå Error fetching historical data:', error);
                document.getElementById('timeline-content').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        Failed to load historical data: ${error.message}
                    </div>
                `;
            }
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',');
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',');
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    data.push(row);
                }
            }
            
            return data;
        }

        function updateTimeline(historicalData) {
            console.log('üìà Starting updateTimeline with data:', historicalData.length, 'records');
            const timelineContent = document.getElementById('timeline-content');
            
            if (!historicalData || historicalData.length === 0) {
                console.log('‚ùå No historical data available');
                timelineContent.innerHTML = '<div class="error">No historical data available</div>';
                return;
            }

            // Clear previous content
            timelineContent.innerHTML = '<div id="d3-heatmap"></div>';
            console.log('üßπ Cleared timeline content, added d3-heatmap div');

            // Group data by date and beach
            const dateBeachMap = {};
            const beaches = new Set();
            const dates = new Set();
            
            historicalData.forEach(record => {
                const date = new Date(record.record_timestamp_utc).toLocaleDateString();
                const beach = record.beach_name;
                const status = record.status;
                
                beaches.add(beach);
                dates.add(date);
                
                if (!dateBeachMap[date]) {
                    dateBeachMap[date] = {};
                }
                dateBeachMap[date][beach] = status;
            });
            
            // Sort dates and beaches
            const sortedDates = Array.from(dates).sort();
            
            // Order beaches to match the chart at the top, with Blodgett moved below Texaco
            const beachOrder = [
                "North Shore Natural Area",
                "Leddy Beach North", 
                "Leddy Beach South",
                "North Beach North",
                "North Beach South", 
                "Texaco Beach",
                "Blodgett Water Access Point",
                "Blanchard Beach North",
                "Blanchard Beach South",
                "Oakledge Cove"
            ];
            
            const sortedBeaches = beachOrder.filter(beach => beaches.has(beach));
            
            // Create data for D3 heatmap
            const heatmapData = [];
            sortedBeaches.forEach((beach, beachIndex) => {
                sortedDates.forEach((date, dateIndex) => {
                    const status = dateBeachMap[date]?.[beach] || 'unknown';
                    heatmapData.push({
                        beach: beach,
                        date: date,
                        status: status,
                        beachIndex: beachIndex,
                        dateIndex: dateIndex
                    });
                });
            });
            
            console.log('üìä Heatmap data created:', heatmapData.length, 'data points');
            console.log('üèñÔ∏è Sorted beaches:', sortedBeaches);
            console.log('üìÖ Sorted dates:', sortedDates);
            console.log('üîç Sample heatmap data:', heatmapData.slice(0, 3));

            // Create D3 heatmap
            console.log('üé® Creating D3 heatmap...');
            createD3Heatmap(heatmapData, sortedBeaches, sortedDates);
        }

        function createD3Heatmap(data, beaches, dates) {
            console.log('üé® createD3Heatmap called with:', data.length, 'data points,', beaches.length, 'beaches,', dates.length, 'dates');
            
            // Get container width for responsive design
            const container = document.getElementById('d3-heatmap');
            
            if (!container) {
                console.error('‚ùå d3-heatmap container not found!');
                return;
            }
            
            const containerWidth = container.offsetWidth || 1200;
            console.log('üìè Container width:', containerWidth);
            
            const margin = {top: 50, right: 50, bottom: 150, left: 200};
            const width = Math.min(containerWidth - margin.left - margin.right, 1000);
            const height = 400 - margin.top - margin.bottom;
            
            console.log('üìè Calculated dimensions:', { width, height, margin });

            // Clear previous SVG
            d3.select("#d3-heatmap").selectAll("*").remove();

            const svg = d3.select("#d3-heatmap")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Color scale for status - matching index page colors
            const colorScale = d3.scaleOrdinal()
                .domain(['green', 'yellow', 'red', 'unknown'])
                .range(['#00a045', '#c7a900', '#c21616', '#cccccc']);

            // X scale (dates) - responsive to number of days
            const xScale = d3.scaleBand()
                .domain(dates)
                .range([0, width])
                .padding(0.05); // Reduced padding for more days

            // Y scale (beaches)
            const yScale = d3.scaleBand()
                .domain(beaches)
                .range([0, height])
                .padding(0.1);

            // Create rectangles for each cell
            svg.selectAll("rect")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", d => xScale(d.date))
                .attr("y", d => yScale(d.beach))
                .attr("width", xScale.bandwidth())
                .attr("height", yScale.bandwidth())
                .attr("fill", d => colorScale(d.status))
                .attr("stroke", "#fff")
                .attr("stroke-width", 1)
                .style("opacity", 0.8)
                .on("mouseover", function(event, d) {
                    d3.select(this)
                        .style("opacity", 1)
                        .attr("stroke-width", 2);
                    
                    // Show tooltip
                    const tooltip = d3.select("body").append("div")
                        .attr("class", "tooltip")
                        .style("position", "absolute")
                        .style("background", "rgba(0,0,0,0.8)")
                        .style("color", "white")
                        .style("padding", "8px")
                        .style("border-radius", "4px")
                        .style("font-size", "12px")
                        .style("pointer-events", "none")
                        .style("z-index", "1000");
                    
                    tooltip.html(`
                        <strong>${d.beach}</strong><br/>
                        Date: ${d.date}<br/>
                        Status: ${d.status.toUpperCase()}
                    `)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function(event, d) {
                    d3.select(this)
                        .style("opacity", 0.8)
                        .attr("stroke-width", 1);
                    d3.selectAll(".tooltip").remove();
                });

            // Add X axis (dates) with responsive text rotation
            const xAxis = svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale));

            // Adjust text rotation based on number of dates
            const textRotation = dates.length > 10 ? -45 : -30;
            xAxis.selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", `rotate(${textRotation})`);

            // Add Y axis (beaches) with better spacing
            svg.append("g")
                .call(d3.axisLeft(yScale))
                .selectAll("text")
                .style("font-size", "11px");

            // Add legend at the bottom
            const legend = svg.append("g")
                .attr("class", "legend")
                .attr("transform", `translate(0, ${height + 80})`);

            // Add legend title
            legend.append("text")
                .attr("x", 0)
                .attr("y", -10)
                .text("Beach Status Legend")
                .style("font-size", "14px")
                .style("font-weight", "bold");

            const legendData = [
                {status: 'green', label: 'Open for Swimming', description: 'Safe water quality'},
                {status: 'yellow', label: 'Proceed with Caution', description: 'Elevated bacteria levels'},
                {status: 'red', label: 'Closed for Swimming', description: 'Unsafe water quality'},
                {status: 'unknown', label: 'Status Unknown', description: 'No data available'}
            ];

            // Create horizontal legend layout
            const legendItemWidth = width / legendData.length;
            legend.selectAll("g")
                .data(legendData)
                .enter()
                .append("g")
                .attr("transform", (d, i) => `translate(${i * legendItemWidth}, 0)`)
                .each(function(d, i) {
                    const g = d3.select(this);
                    
                    // Color box
                    g.append("rect")
                        .attr("x", 0)
                        .attr("y", 0)
                        .attr("width", 15)
                        .attr("height", 15)
                        .attr("fill", colorScale(d.status))
                        .attr("stroke", "#333")
                        .attr("stroke-width", 1);
                    
                    // Label
                    g.append("text")
                        .attr("x", 20)
                        .attr("y", 5)
                        .text(d.label)
                        .style("font-size", "11px")
                        .style("font-weight", "bold");
                    
                    // Description
                    g.append("text")
                        .attr("x", 20)
                        .attr("y", 18)
                        .text(d.description)
                        .style("font-size", "9px")
                        .style("fill", "#666");
                });
        }

        // Initialize the page
        fetchBeachData();
        fetchHistoricalData();
    </script>
</body>
</html> 