<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lakewood Beach Status - Water Quality & Conditions</title>
    <meta name="description" content="Real-time water quality status for Lakewood Beach. Check current conditions, weather, and air quality for your perfect beach day.">
    
    <!-- Tailwind CSS -->
    <link href="./dist/output.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <i class="fas fa-water text-primary-600 text-2xl mr-3"></i>
                    <h1 class="text-2xl font-bold text-gray-900">Lakewood Beach</h1>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Status Card -->
        <div class="card p-6 mb-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">Current Status</h2>
                <div id="status-display" class="text-6xl mb-4">
                    <!-- Status will be populated here -->
                </div>
                <p id="status-text" class="text-xl text-gray-600 mb-4">
                    <!-- Status text will be populated here -->
                </p>
                <div id="status-note-container" class="mb-4" style="display: none;">
                    <p class="text-sm text-gray-500 mb-1">Note:</p>
                    <p id="status-note" class="text-gray-600 bg-gray-50 rounded-lg p-3">
                        <!-- Additional notes will be populated here -->
                    </p>
                </div>
                <div class="text-sm text-gray-500 mt-4">
                    <i class="fas fa-clock mr-1"></i>
                    Last updated: <span id="last-updated">Loading...</span>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <a href="https://anrweb.vt.gov/FPR/SwimWater/CityOfBurlingtonPublicReport.aspx" target="_blank" class="text-sm text-primary-600 hover:text-primary-700">
                        <i class="fas fa-file-pdf mr-1"></i>
                        View official water quality report
                    </a>
                </div>
            </div>
        </div>

        <!-- Weather and Air Quality Grid -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- Current Weather Widget -->
            <div class="card p-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">
                    <i class="fas fa-cloud-sun text-primary-600 mr-2"></i>
                    Current Weather
                </h3>
                <div id="weather-content" class="text-center">
                    <div class="text-sm text-gray-500 mb-2">
                        <i class="fas fa-map-marker-alt mr-1"></i>
                        Burlington, VT (05408)
                    </div>
                    <div class="text-4xl font-bold text-gray-900 mb-2">
                        <span id="temperature">--</span>Â°F
                    </div>
                    <div class="text-lg text-gray-600 mb-4">
                        <span id="conditions">Loading...</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <i class="fas fa-wind text-gray-400 mr-1"></i>
                            <span id="wind-speed">--</span> mph
                        </div>
                        <div>
                            <i class="fas fa-tint text-gray-400 mr-1"></i>
                            <span id="humidity">--</span>%
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <a href="https://openweathermap.org/city/5233828" target="_blank" class="text-sm text-primary-600 hover:text-primary-700">
                            <i class="fas fa-external-link-alt mr-1"></i>
                            View detailed forecast
                        </a>
                    </div>
                </div>
            </div>

            <!-- Air Quality Widget -->
            <div class="card p-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">
                    <i class="fas fa-leaf text-primary-600 mr-2"></i>
                    Air Quality
                </h3>
                <div id="air-quality-content" class="text-center">
                    <div class="text-4xl font-bold text-gray-900 mb-2">
                        <span id="aqi">--</span>
                    </div>
                    <div class="text-lg text-gray-600 mb-4">
                        <span id="aqi-text">Loading...</span>
                    </div>
                    <div class="text-sm text-gray-500">
                        <span id="aqi-advice">Checking air quality...</span>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <a href="https://www.airnow.gov/?city=Burlington&state=VT&country=USA" target="_blank" class="text-sm text-primary-600 hover:text-primary-700">
                            <i class="fas fa-external-link-alt mr-1"></i>
                            View detailed air quality
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upcoming Weather and Wave Report Grid -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- Upcoming Weather Widget -->
            <div class="card p-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">
                    <i class="fas fa-calendar-alt text-primary-600 mr-2"></i>
                    Upcoming Weather
                </h3>
                <div id="upcoming-weather-content">
                    <div class="text-sm text-gray-500 text-center">Loading hourly forecast...</div>
                </div>
            </div>

            <!-- Wave Report Widget -->
            <div class="card p-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">
                    <i class="fas fa-water text-primary-600 mr-2"></i>
                    Wave Report
                </h3>
                <div id="wave-report-content">
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center mb-4">
                        <div>
                            <div class="text-3xl font-bold text-gray-900">
                                <span id="wave-height">--</span> ft
                            </div>
                            <div class="text-sm text-gray-600">Wave Height</div>
                        </div>
                        <div>
                            <div class="text-xl font-semibold text-gray-900">
                                <span id="wave-wind-speed">--</span> mph
                            </div>
                            <div class="text-sm text-gray-600">Wind Speed</div>
                        </div>
                        <div>
                            <div class="text-lg font-semibold text-gray-900">
                                <span id="wave-wind-direction">--</span>
                            </div>
                            <div class="text-sm text-gray-600">Wind Direction</div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500 text-center">
                        <i class="fas fa-info-circle mr-1"></i>
                        <span id="wave-explanation">Wave estimates based on wind conditions across Lake Champlain</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alternative Beach Info -->
        <div id="alternative-beach-section" class="card p-6 mb-8" style="display: none;">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">
                <i class="fas fa-map-marker-alt text-primary-600 mr-2"></i>
                Alternative Beaches
            </h3>
            <div id="alternative-beach-info">
                <!-- Alternative beach information will be populated here -->
            </div>
        </div>

        <!-- Email Subscription -->
        <div class="card p-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">
                <i class="fas fa-bell text-primary-600 mr-2"></i>
                Get Notifications
            </h3>
            <p class="text-gray-600 mb-4">
                Subscribe to receive email notifications when Lakewood Beach status changes.
            </p>
            <form id="subscription-form" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                        Email Address
                    </label>
                    <input type="email" id="email" name="email" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                           placeholder="your@email.com">
                </div>
                <button type="submit" class="btn-primary">
                    <i class="fas fa-paper-plane mr-2"></i>
                    Subscribe to Notifications
                </button>
            </form>
            <div id="subscription-message" class="mt-4" style="display: none;">
                <!-- Subscription messages will be shown here -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center">
                <p class="text-gray-300">
                    Data provided by Vermont Department of Health â¢ 
                    Weather data from OpenWeatherMap â¢ 
                    Air quality data from AirNow
                </p>
            </div>
        </div>
    </footer>

    <!-- Custom JS -->
    <script>
        // Configuration
        const BASE_API_URL = "https://beach-api.terrencefradet.workers.dev";
        const LAKEWOOD_BEACH = {
            lat: 44.501457,
            lon: -73.252218
        };
        let allBeaches = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            fetchBeachData();
            fetchWeatherData().then(() => {
                // Fetch wave data after weather data is available
                fetchWaveData();
            });
            fetchAirQualityData();
            fetchUpcomingWeather();
            setupSubscriptionForm();
        });

        // Fetch beach data
        async function fetchBeachData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/tjamjam/beach-app/main/status.json');
                if (!response.ok) throw new Error('Failed to fetch beach data');
                
                allBeaches = await response.json();
                const lakewoodBeach = allBeaches.find(b => b.beach_name === "Leddy Beach South");
                
                if (lakewoodBeach) {
                    displayStatus(lakewoodBeach);
                    displayAlternativeBeach(allBeaches, "Leddy Beach South");
                } else {
                    displayError("Lakewood Beach data not available");
                }
                
                updateLastUpdated();
                
            } catch (error) {
                console.error('Error fetching beach data:', error);
                displayError("Failed to load beach data");
            }
        }

        // Display status
        function displayStatus(beach) {
            const statusDisplay = document.getElementById('status-display');
            const statusText = document.getElementById('status-text');
            const statusNote = document.getElementById('status-note');
            const statusNoteContainer = document.getElementById('status-note-container');
            
            let statusIcon, statusClass, statusDescription;
            
            switch(beach.status) {
                case 'green':
                    statusIcon = 'ð¢';
                    statusClass = 'text-beach-green';
                    statusDescription = 'OPEN';
                    break;
                case 'yellow':
                    statusIcon = 'ð¡';
                    statusClass = 'text-beach-yellow';
                    statusDescription = 'ALERT';
                    break;
                case 'red':
                    statusIcon = 'ð´';
                    statusClass = 'text-beach-red';
                    statusDescription = 'CLOSED';
                    break;
                default:
                    statusIcon = 'âª';
                    statusClass = 'text-gray-500';
                    statusDescription = 'UNKNOWN';
            }
            
            statusDisplay.innerHTML = `<span class="${statusClass}">${statusIcon}</span>`;
            statusText.textContent = statusDescription;
            
            // Show note container only if there's a note
            if (beach.note && beach.note.trim() !== '') {
                statusNote.textContent = beach.note;
                statusNoteContainer.style.display = 'block';
            } else {
                statusNoteContainer.style.display = 'none';
            }
        }

        // Display alternative beach information
        function displayAlternativeBeach(allBeaches, targetBeachName) {
            const targetBeach = allBeaches.find(b => b.beach_name === targetBeachName);
            const adviceContainer = document.getElementById('alternative-beach-info');
            const alternativeSection = document.getElementById('alternative-beach-section');

            // If the target beach is open or we can't find its data, hide the suggestion
            if (!targetBeach || targetBeach.status === 'green' || !targetBeach.coordinates) {
                alternativeSection.style.display = 'none';
                return;
            }

            const openBeaches = allBeaches.filter(b => b.status === 'green' && b.coordinates);

            // If the list of open beaches is empty, display the specific message
            if (openBeaches.length === 0) {
                adviceContainer.innerHTML = `
                    <p class="text-gray-600 italic">There are no other open beaches at this time.</p>
                `;
                alternativeSection.style.display = 'block';
                return;
            }

            // Calculate distances and find the closest
            const targetCoords = targetBeach.coordinates;
            let closestBeach = null;
            let shortestDistance = Infinity;

            openBeaches.forEach(beach => {
                const distance = calculateDistance(
                    targetCoords.lat, targetCoords.lon,
                    beach.coordinates.lat, beach.coordinates.lon
                );
                
                if (distance < shortestDistance) {
                    shortestDistance = distance;
                    closestBeach = beach;
                }
            });

            if (closestBeach) {
                const distanceText = shortestDistance < 1 ? 
                    `${Math.round(shortestDistance * 1000)}m away` : 
                    `${shortestDistance.toFixed(1)}km away`;

                adviceContainer.innerHTML = `
                    <p class="text-gray-600 mb-2">Instead, the closest open beach is:</p>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-900">${closestBeach.beach_name}</h4>
                        <p class="text-sm text-gray-600 mt-1">${distanceText}</p>
                        <p class="text-sm text-gray-500 mt-1">${closestBeach.note || 'No additional information'}</p>
                    </div>
                `;
                alternativeSection.style.display = 'block';
            }
        }

        // Calculate distance between two points
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in kilometers
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Fetch weather data
        async function fetchWeatherData() {
            try {
                const response = await fetch(`${BASE_API_URL}/weather`);
                if (!response.ok) throw new Error('Weather API failed');
                
                const data = await response.json();
                currentWeatherData = data; // Store globally for wave report
                displayWeather(data.current);
                
            } catch (error) {
                console.error('Error fetching weather:', error);
                document.getElementById('weather-content').innerHTML = `
                    <div class="text-red-600">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>Weather data unavailable</p>
                    </div>
                `;
            }
        }

        // Display weather data
        function displayWeather(weather) {
            document.getElementById('temperature').textContent = weather.temperature;
            document.getElementById('conditions').textContent = weather.conditions;
            document.getElementById('wind-speed').textContent = weather.windSpeed;
            document.getElementById('humidity').textContent = weather.humidity;
        }

        // Fetch air quality data
        async function fetchAirQualityData() {
            try {
                const response = await fetch(`${BASE_API_URL}/air-quality`);
                if (!response.ok) throw new Error('Air quality API failed');
                
                const data = await response.json();
                displayAirQuality(data);
                
            } catch (error) {
                console.error('Error fetching air quality:', error);
                document.getElementById('air-quality-content').innerHTML = `
                    <div class="text-red-600">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>Air quality data unavailable</p>
                    </div>
                `;
            }
        }

        // Display air quality data
        function displayAirQuality(data) {
            document.getElementById('aqi').textContent = data.aqi;
            document.getElementById('aqi-text').textContent = data.text;
            document.getElementById('aqi-advice').textContent = data.advice;
        }

        // Fetch upcoming weather data
        async function fetchUpcomingWeather() {
            try {
                const response = await fetch(`${BASE_API_URL}/weather`);
                if (!response.ok) throw new Error('Weather API failed');
                
                const data = await response.json();
                displayUpcomingWeather(data.hourly);
                
            } catch (error) {
                console.error('Error fetching upcoming weather:', error);
                document.getElementById('upcoming-weather-content').innerHTML = `
                    <div class="text-red-600">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>Upcoming weather data unavailable</p>
                    </div>
                `;
            }
        }

        // Display upcoming weather data with wave predictions
        function displayUpcomingWeather(hourlyData) {
            const container = document.getElementById('upcoming-weather-content');
            
            if (!hourlyData || hourlyData.length === 0) {
                container.innerHTML = '<div class="text-gray-500">No forecast data available</div>';
                return;
            }

            const forecastHTML = hourlyData.map(hour => {
                // Estimate wave height for this hour (simplified - would need wind data)
                const waveHeight = estimateFutureWaveHeight(hour);
                const windSpeed = hour.windSpeed || "N/A";
                
                return `
                    <div class="flex items-center justify-between py-4 border-b border-gray-100 last:border-b-0">
                        <!-- Time and Temperature -->
                        <div class="flex-1">
                            <div class="font-semibold text-gray-900 text-sm">${hour.time}</div>
                            <div class="text-xl font-bold text-gray-900">${hour.temp}Â°F</div>
                        </div>
                        
                        <!-- Weather Icon -->
                        <div class="flex-shrink-0 mx-4">
                            <img src="${hour.icon}" alt="${hour.description}" class="w-8 h-8">
                        </div>
                        
                        <!-- Weather Details -->
                        <div class="flex-1 text-right">
                            <div class="text-sm text-gray-900 font-medium">${hour.description}</div>
                            <div class="text-xs text-gray-600 mt-1">
                                <span class="mr-3">Wind: ${windSpeed} mph</span>
                                <span>Waves: ${waveHeight}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `
                <div class="space-y-1">
                    ${forecastHTML}
                </div>
            `;
        }

        // Estimate future wave height based on wind data if available
        function estimateFutureWaveHeight(hourData) {
            // If we have wind data, use it for more accurate estimates
            if (hourData.windSpeed && hourData.windDirection) {
                const windSpeed = parseFloat(hourData.windSpeed);
                const windDirection = hourData.windDirection;
                
                // Use the same logic as current wave estimation
                const fetchDistance = calculateFetchDistance(windDirection);
                
                if (windSpeed < 5) {
                    return "0-1 ft";
                } else if (windSpeed < 10) {
                    return fetchDistance > 5 ? "1-2 ft" : "0-1 ft";
                } else if (windSpeed < 15) {
                    return fetchDistance > 6 ? "2-3 ft" : "1-2 ft";
                } else if (windSpeed < 20) {
                    return fetchDistance > 5 ? "3-4 ft" : "2-3 ft";
                } else {
                    return fetchDistance > 4 ? "4-5 ft" : "3-4 ft";
                }
            }
            
            // Fallback to temperature-based estimate if no wind data
            const temp = parseInt(hourData.temp);
            if (temp > 80) return "1-2 ft";
            else if (temp > 70) return "0-1 ft";
            else return "0-1 ft";
        }

        // Global variable to store weather data
        let currentWeatherData = null;

        // Fetch wave data based on wind conditions
        async function fetchWaveData() {
            try {
                // Use the weather data that was already fetched
                if (!currentWeatherData) {
                    // If weather data isn't available yet, fetch it
                    const response = await fetch(`${BASE_API_URL}/weather`);
                    if (!response.ok) throw new Error('Weather API failed');
                    currentWeatherData = await response.json();
                }
                
                const windSpeed = parseFloat(currentWeatherData.current.windSpeed);
                const windDirection = currentWeatherData.current.windDirection;
                
                // Estimate wave conditions based on wind
                const waveData = estimateWaveConditions(windSpeed, windDirection);
                displayWaveData(waveData);
                
            } catch (error) {
                console.error('Error fetching wave data:', error);
                document.getElementById('wave-report-content').innerHTML = `
                    <div class="text-red-600">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>Wave data unavailable</p>
                    </div>
                `;
            }
        }

        // Estimate wave conditions based on wind speed, direction, and fetch
        function estimateWaveConditions(windSpeed, windDirection) {
            let height, explanation;
            
            // Calculate effective fetch based on wind direction
            const fetchDistance = calculateFetchDistance(windDirection);
            
            // Estimate wave height considering wind speed and fetch for Lakewood Beach
            if (windSpeed < 5) {
                height = "0-1";
                explanation = "Light winds across Appletree Bay";
            } else if (windSpeed < 10) {
                if (fetchDistance > 5) {
                    height = "1-2";
                    explanation = "Light winds with good fetch across bay";
                } else {
                    height = "0-1";
                    explanation = "Light winds with limited fetch";
                }
            } else if (windSpeed < 15) {
                if (fetchDistance > 6) {
                    height = "2-3";
                    explanation = "Moderate winds with good fetch across Appletree Bay";
                } else if (fetchDistance > 3) {
                    height = "1-2";
                    explanation = "Moderate winds with moderate fetch";
                } else {
                    height = "1-2";
                    explanation = "Moderate winds but limited fetch (land blocks)";
                }
            } else if (windSpeed < 20) {
                if (fetchDistance > 5) {
                    height = "3-4";
                    explanation = "Strong winds with good fetch across bay";
                } else if (fetchDistance > 3) {
                    height = "2-3";
                    explanation = "Strong winds with moderate fetch";
                } else {
                    height = "2-3";
                    explanation = "Strong winds but limited fetch";
                }
            } else {
                if (fetchDistance > 4) {
                    height = "4-5";
                    explanation = "High winds with good fetch across Appletree Bay";
                } else {
                    height = "3-4";
                    explanation = "High winds but limited fetch";
                }
            }
            
            // Convert abbreviated wind direction to full name
            const windDirectionFull = convertWindDirection(windDirection);
            
            return {
                height: height,
                windSpeed: windSpeed,
                windDirection: windDirectionFull,
                explanation: explanation
            };
        }

        // Calculate effective fetch distance based on wind direction for Lakewood Beach
        function calculateFetchDistance(windDirection) {
            // Lakewood Beach is located in Appletree Bay on the eastern shore
            // Based on the actual geography, here are the fetch distances:
            
            const fetchDistances = {
                'W': 8,     // West wind: crosses Appletree Bay (~8 miles)
                'WSW': 7,   // West-southwest: good fetch across bay
                'SW': 6,    // Southwest: moderate fetch
                'SSW': 4,   // South-southwest: limited fetch
                'S': 2,     // South: very limited fetch (land blocks)
                'SSE': 1,   // South-southeast: minimal fetch
                'SE': 1,    // Southeast: minimal fetch
                'ESE': 1,   // East-southeast: no fetch (wind from land)
                'E': 0,     // East: no fetch (wind from land)
                'ENE': 0,   // East-northeast: no fetch
                'NE': 1,    // Northeast: minimal fetch
                'NNE': 2,   // North-northeast: limited fetch
                'N': 3,     // North: limited fetch
                'NNW': 4,   // North-northwest: moderate fetch
                'NW': 5,    // Northwest: good fetch
                'WNW': 6    // West-northwest: good fetch
            };
            
            return fetchDistances[windDirection] || 3; // Default to limited fetch
        }

        // Convert abbreviated wind direction to full name
        function convertWindDirection(abbreviated) {
            const directions = {
                'N': 'North',
                'NNE': 'North-Northeast',
                'NE': 'Northeast',
                'ENE': 'East-Northeast',
                'E': 'East',
                'ESE': 'East-Southeast',
                'SE': 'Southeast',
                'SSE': 'South-Southeast',
                'S': 'South',
                'SSW': 'South-Southwest',
                'SW': 'Southwest',
                'WSW': 'West-Southwest',
                'W': 'West',
                'WNW': 'West-Northwest',
                'NW': 'Northwest',
                'NNW': 'North-Northwest'
            };
            
            return directions[abbreviated] || abbreviated;
        }

        // Display wave data
        function displayWaveData(data) {
            document.getElementById('wave-height').textContent = data.height;
            document.getElementById('wave-wind-speed').textContent = data.windSpeed;
            document.getElementById('wave-wind-direction').textContent = data.windDirection;
            document.getElementById('wave-explanation').textContent = data.explanation;
        }

        // Setup subscription form
        function setupSubscriptionForm() {
            const form = document.getElementById('subscription-form');
            const messageDiv = document.getElementById('subscription-message');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('email').value;
                const submitButton = form.querySelector('button[type="submit"]');
                const originalText = submitButton.innerHTML;
                
                // Show loading state
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Subscribing...';
                
                try {
                    const response = await fetch(`${BASE_API_URL}/subscribe`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email: email })
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        messageDiv.innerHTML = `
                            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
                                <i class="fas fa-check mr-2"></i>
                                Successfully subscribed! You'll receive notifications when Lakewood Beach status changes.
                            </div>
                        `;
                        form.reset();
                    } else {
                        throw new Error(result.error || 'Subscription failed');
                    }
                    
                } catch (error) {
                    messageDiv.innerHTML = `
                        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            ${error.message}
                        </div>
                    `;
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalText;
                    messageDiv.style.display = 'block';
                    
                    // Hide message after 5 seconds
                    setTimeout(() => {
                        messageDiv.style.display = 'none';
                    }, 5000);
                }
            });
        }

        // Update last updated timestamp
        function updateLastUpdated() {
            if (allBeaches.length > 0) {
                const latestUpdate = allBeaches.reduce((latest, beach) => {
                    const beachDate = new Date(beach.date);
                    return beachDate > latest ? beachDate : latest;
                }, new Date(0));
                
                document.getElementById('last-updated').textContent = 
                    latestUpdate.toLocaleString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        hour: 'numeric', 
                        minute: '2-digit' 
                    });
            }
        }

        // Display error
        function displayError(message) {
            const statusDisplay = document.getElementById('status-display');
            const statusText = document.getElementById('status-text');
            const statusNote = document.getElementById('status-note');
            
            statusDisplay.innerHTML = '<span class="text-gray-500">â ï¸</span>';
            statusText.textContent = 'ERROR';
            statusNote.textContent = message;
        }
    </script>
</body>
</html> 